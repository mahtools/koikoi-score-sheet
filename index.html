<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Koi-koi scoresheet</title>
        <style>
            :root {
                --bg: #FFFFFF;
                --fg: #000000;
                --cell-height: 20px;
            }
            #cols {
                display: flex;
            }

            #month, #pic, #oyain, #koin, #monthinner, #picinner, #oyainner, #koinner {
                display: flex;
                flex-direction: column;
            }

            input, p {
                height: var(--cell-height);
                margin: 0;
                padding: 0;
                box-sizing: border-box;

                display: flex;
                justify-content: center;
            }
        </style>
    </head>

    <body>
        <div id="content">
            <div id="cols">
                <div id="month">
                    <p>月/Month</p>
                    <div id="monthinner"></div>
                </div>
                <div id="pic">
                    <p></p>
                    <div id="picinner"></div>
                </div>
                <div id="oyain">
                    <p>親/Oya</p>
                    <div id="oyainner"></div>
                    <p id="oyatotal"></p>
                </div>
                <div id="koin">
                    <p>子/Ko</p>
                    <div id="koinner"></div>
                    <p id="kototal"></p>
                </div>
            </div>

            <div id="controls">
                <input type="number" name="sizeinput" id="sizeinput" min="1" max="12" value="1">
                <label for="sizeinput">月/months</label>
                <button id="newgame"> 勝負/Go</button>
            </div>

        </div>

        <script>
            // Elements
            const INP_NEWGAME = document.getElementById("sizeinput");
            const BTN_NEWGAME = document.getElementById("newgame");

            const MONTHS = document.getElementById("monthinner");
            const PICS = document.getElementById("picinner");
            const OYAIN = document.getElementById("oyainner");
            const KOIN = document.getElementById("koinner");

            const OYATOTAL = document.getElementById("oyatotal");
            const KOTOTAL = document.getElementById("kototal");

            // State
            let oyaTotal = 0;
            let koTotal = 0;

            // Bindings
            function recalculateTotals() {
                oyaTotal = 0;
                koTotal = 0;

                OYAIN.childNodes.forEach(node => oyaTotal += parseInt(node.value));
                KOIN.childNodes.forEach(node => koTotal += parseInt(node.value));

                OYATOTAL.innerText = oyaTotal;
                KOTOTAL.innerText = koTotal;
            }

            BTN_NEWGAME.addEventListener("click", () => {
                const val = parseInt(INP_NEWGAME.value);
                console.log(val);

                // Clearing elements
                MONTHS.innerHTML = "";
                PICS.innerHTML = "";
                OYAIN.innerHTML = "";
                KOIN.innerHTML = "";

                // Creating new elements
                for (let i = 1; i <= val; i++) {
                    // Month
                    const m = document.createElement("p");
                    m.innerText = i;
                    MONTHS.appendChild(m);


                    // Pic
                    const p = document.createElement("svg");
                    PICS.appendChild(p);
                    

                    // Oya
                    const o = document.createElement("input");
                    o.addEventListener("change", (_) => recalculateTotals());
                    o.type = "number";
                    o.min = 0;
                    o.value = 0;
                    o.innerText = i;
                    OYAIN.appendChild(o);


                    // Ko
                    const k = o.cloneNode(true);
                    KOIN.appendChild(k);
                
                    // Refresh totals
                    recalculateTotals();
                }
            });
        </script>
        <noscript>  <!-- Hiding the entire page if no script is active -->
            <style>#content {display: none} </style>
            <span>Please enable JavaScript</span>
        </noscript>
    </body>
</html>
